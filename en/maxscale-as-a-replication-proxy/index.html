<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title> MaxScale as a replication proxy - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.9a0d7dcebefd.css" rel="stylesheet" type="text/css" />

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content=" MaxScale as a replication proxy" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/maxscale-as-a-replication-proxy/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="MaxScale as a Binlog Server
MaxScale was designed as a highly configurable proxy that sits between a database layer and the clients of that database, the binlog router describ..." />

    <meta name="description" content="MaxScale as a Binlog Server
MaxScale was designed as a highly configurable proxy that sits between a database layer and the clients of that database, the binlog router describ..." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/maxscale-as-a-replication-proxy/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2023 MariaDB. All rights reserved.</p>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/maxscale-as-a-replication-proxy/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/maxscale/">MariaDB MaxScale</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-maxscale-14/">MariaDB MaxScale 1.4</a>
    

    
    » <a class="crumb" href="/kb/en/maxscale-14-tutorials/">MaxScale 1.4 Tutorials</a>
    


    » <a class="node_link crumb" href="/kb/en/maxscale-as-a-replication-proxy/"> MaxScale as a replication proxy</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/maxscale-as-a-replication-proxy/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/maxscale-as-a-replication-proxy/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/maxscale-as-a-replication-proxy/+flag"
                data-flag-url="/kb/en/maxscale-as-a-replication-proxy/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/maxscale-as-a-replication-proxy/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2015-05-06 22:46">8 years ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2015-05-06 22:46">8 years ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/maxscale-as-a-replication-proxy/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
        <dt>Source</dt>
        <dd><a href="https://github.com/mariadb-corporation/MaxScale/blob/1.4.5/Documentation/Tutorials/Replication-Proxy-Binlog-Router-Tutorial.md">GitHub</a></dd>
        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/maxscale-as-a-replication-proxy/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/maxscale-as-a-replication-proxy/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/maxscale-as-a-replication-proxy/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1> MaxScale as a replication proxy</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <h1 id="maxscale-as-a-binlog-server">MaxScale as a Binlog Server</h1>
<p>MaxScale was designed as a highly configurable proxy that sits between a database layer and the clients of that database, the binlog router described here is somewhat different to that original concept, moving MaxScale down to play a role within the database layer itself.</p>
<p>In a traditional MySQL replication setup a single master server is created and a set of slaves MySQL instances are configured to pull the binlog files from that master to the slaves. There are some problems, however, in this setup; when the number of slaves grows an increasing load is placed on the master, to serve the binlogs to each slave. When the master server fails, some action must be performed on every slave server before a new server can become the master server.</p>
<p>Introducing a proxy layer between the master server and the slave servers can improve the situation, by reducing the load on the master to simply serving the proxy layer rather than all of the slaves. The slaves only need to be aware of the proxy layer and not of the real master server. Removing need for the slaves to have knowledge of the master, greatly simplifies the process of replacing a failed master within a replication environment.</p>
<h2 id="mariadbmysql-as-a-binlog-server">MariaDB/MySQL as a Binlog Server</h2>
<p>The most obvious solution to the requirement for a proxy layer within a replication environment is to use a MariaDB or MySQL database instance. The database server is designed to allow this, since a slave server is able to be configured such that it will produce binary logs for updates it has itself received via replication from the master server. This is done with the <em>log_slave_updates</em> configuration option of the server. In this case the server is known as an intermediate master, it is simultaneously a slave to the real master and a master to the other slaves in the configuration.</p>
<p>Using an intermediate master does not, however, solve all the problems and introduces some new ones, due to the way replication is implemented. A slave server reads the binary log data and creates a relay log from that binary log. This log provides a source of SQL statements, which are executed within the slave in order to make the same changes to the databases on the slaves as were made on the master. If the <em>log_slave_updates</em> option has been enabled, new binary log entries are created for the statements executed from the relay log.</p>
<p>The above means that the data in the binary log of the intermediate master is not a direct copy of the data that was received from the binary log of the real master. The resultant changes to the database will be the same, provided no updates have been performed on the intermediate master that did not originate on the real master, but the steps to achieve those changes may be different. In particular, if group commit functionality is used, to allow multiple transactions to commit in parallel, these may well be different on the intermediate master. This can cause a reduction in the parallelism of the commits and a subsequent reduction in the performance of the slave servers.</p>
<p>This re-execution of the SQL statements also adds latency to the intermediate master solution, since the full process of parsing, optimization and execution must occur for every statement that is replicated from the master to the slaves must be performed in the intermediate master. This latency introduces lag in the replication chain, with a greater delay being introduced from the time a transaction is committed on the master until the data is available on the slaves.</p>
<p>Use of an intermediate master does improve the process of failover of the master server, since the slaves are only aware of the intermediate master the process of promoting one of the existing slaves to become the new master only involves that slave and the intermediate master. A slave can become the new master as soon as all the changes from the intermediate master have been processed. The intermediate master then needs to be reset to the correct point in the binary log of the new master and replication can continue.</p>
<p>An added complexity that needs to be dealt with is the failure of the intermediate master itself. If this occurs then the same problem as described earlier exists, all slaves must be updated when a new intermediate master is created. If multiple intermediate masters are used, there is also a restriction that slaves can not be moved from the failed intermediate master to another intermediate master due to the fact that the binlog on the different intermediate nodes are not guaranteed to be the same.</p>
<h2 id="maxscales-approach">MaxScale's approach</h2>
<p>MaxScale takes a much simpler approach to the process of being a Binlog Server. It acts as a slave to the real master and as a master to the slaves, in the same way as an intermediate master does. However, it does not implement any re-execution of the statements within the binary log. MaxScale creates a local cache of the binary logs it receives from the master and will serve binary log events to the slaves from this cache of the master's binary log. This means that the slaves will always get binary log events that have a one-to-one correlation to those written by the master. Parallelism in the binary log events of the master is maintained in the events that are observed by the slaves.</p>
<p>In the MaxScale approach, the latency that is introduced is mostly the added network latency associated with adding the extra network hop. There is no appreciable processing performed at the MaxScale level, other than for managing the local cache of the binlog files.</p>
<p>In addition, every MaxScale that is acting as a proxy of the master will have exactly the same binlog events as the master itself. This means that a slave can be moved between any of the MaxScale server or to the real master without a need to perform any special processing. The result is much simpler behavior for failure recovery and the ability to have a very simple, redundant proxy layer with slaves free to both between the proxies.</p>
<h1 id="configuring-maxscale-as-a-binlog-server">Configuring MaxScale as a Binlog Server</h1>
<p>Using MaxScale as a Binlog Server is much the same as using MaxScale as a proxy between the clients and the database servers. In this case the master server should be considered as the database backend and the slave servers as the clients of MaxScale.</p>
<h2 id="service-configuration">Service Configuration</h2>
<p>As with any MaxScale configuration a good starting point is with the service definition with the <em>maxscale.cnf</em> file. The service requires a name which is the section name in the ini file, a type parameter with a value of service and the name of the router plugin that should be loaded. In the case of replication proxies this router name is <em>binlogrouter</em>.</p>
<div><pre><span></span>[Replication]
type=service
router=binlogrouter
</pre></div>


<p>Other standard service parameters need to be given in the configuration section that are used to retrieve the set of users from the backend (master) database, also a version string can be given such that the MaxScale instance will report this version string to the slave servers that connect to MaxScale.</p>
<div><pre><span></span>[Replication]
type=service
router=binlogrouter
version_string=5.6.17-log
user=maxscale
passwd=Mhu87p2D
</pre></div>


<p>The <em>user</em> and <em>passwd</em> entries in the above example are used in order for MaxScale to populate the credential information that is required to allow the slaves to connect to MaxScale. This user should be configured in exactly the same way a for any other MaxScale service, i.e. the user needs access to the <em>mysql.user</em> table and the <em>mysql.db</em> table as well as having the ability to perform a <em>SHOW DATABASES</em> command.</p>
<p>The master server details are currently provided by a <strong>master.ini</strong> file located in binlog directory and could be changed via <em>CHANGE MASTER TO</em> command issued via MySQL connection to MaxScale; refer to the Master setup section below for further details.</p>
<p>In the current implementation of the router only a single server can be used.</p>
<p>The final configuration requirement is the router specific options. The binlog router requires a set of parameters to be passed, these are passed, as a comma separated list of name value pairs, in the <em>router_options</em> parameter of the service definition..</p>
<h3 id="binlogdir">binlogdir</h3>
<p>This parameter allows the location that MaxScale uses to store binlog files to be set. If this parameter is not set to a directory name then MaxScale will store the binlog files in the directory <em>/var/cache/maxscale/&lt;service name=""&gt;</em>.
In the binlog dir there is also the 'cache' directory that contains data retrieved from the master during registration phase and the <em>master.ini</em> file which contains the configuration of current configured master.</p>
<h3 id="uuid">uuid</h3>
<p>This is used to set the unique uuid that the binlog router uses when it connects to the master server.
If no explicit value is given for the uuid in the configuration file then a uuid will be generated.</p>
<h3 id="server-id">server-id</h3>
<p>As with uuid, MaxScale must have a unique server-id for the connection it makes to the master, this parameter provides the value of server-id that MaxScale will use when connecting to the master.</p>
<h3 id="master-id">master-id</h3>
<p>The server-id value that MaxScale should use to report to the slaves that connect to MaxScale.
This may either be the same as the server-id of the real master or can be chosen to be different if the slaves need to be aware of the proxy layer.
The real master server-id will be used if the option is not set.</p>
<h3 id="master_uuid">master_uuid</h3>
<p>It is a requirement of replication that each slave have a unique UUID value. The MaxScale router will identify itself to the slaves using the uuid of the real master if this option is not set.</p>
<h3 id="master_version">master_version</h3>
<p>The MaxScale router will identify itself to the slaves using the server version of the real master if this option is not set.</p>
<h3 id="master_hostname">master_hostname</h3>
<p>The MaxScale router will identify itself to the slaves using the server hostname of the real master if this option is not set.</p>
<h3 id="user">user</h3>
<p>This is the user name that MaxScale uses when it connects to the master. This user name must have the rights required for replication as with any other user that a slave uses for replication purposes. If the user parameter is not given in the router options then the same user as is used to retrieve the credential information will be used for the replication connection, i.e. the user in the service entry.</p>
<p>The user that is used for replication, either defined using the <em>user=</em> option in the router options or using the username and password defined of the service must be granted replication privileges on the database server.</p>
<div><pre><span></span>    MariaDB&gt; CREATE USER 'repl'@'maxscalehost' IDENTIFIED by 'password';
    MariaDB&gt; GRANT REPLICATION SLAVE ON *.* TO 'repl'@'maxscalehost';
</pre></div>


<h3 id="password">password</h3>
<p>The password of the above user. If the password is not explicitly given then the password in the service entry will be used. For compatibility with other username and password definitions within the MaxScale configuration file it is also possible to use the parameter <em>passwd=</em>.</p>
<h3 id="heartbeat">heartbeat</h3>
<p>This defines the value of the heartbeat interval in seconds for the connection to the master. MaxScale requests the master to ensure that a binlog event is sent at least every heartbeat period. If there are no real binlog events to send the master will sent a special heartbeat event. The default value for the heartbeat period is every 5 minutes. The current interval value is reported in the diagnostic output.</p>
<h3 id="send_slave_heartbeat">send_slave_heartbeat</h3>
<p>This defines whether (on | off) MaxScale sends to the slave the heartbeat packet when there are no real binlog events to send. The default value if 'off', no heartbeat event is sent to slave server. If value is 'on' the interval value (requested by the slave during registration) is reported in the diagnostic output and the packet is send after the time interval without any event to send.</p>
<h3 id="burstsize">burstsize</h3>
<p>This parameter is used to define the maximum amount of data that will be sent to a slave by MaxScale when that slave is lagging behind the master. In this situation the slave is said to be in "catchup mode", this parameter is designed to both prevent flooding of that slave and also to prevent threads within MaxScale spending disproportionate amounts of time with slaves that are lagging behind the master. The burst size can be defined in Kb, Mb or Gb by adding the qualifier K, M or G to the number given. The default value of burstsize is 1Mb and will be used if burstsize is not given in the router options.</p>
<h3 id="transaction_safety">transaction_safety</h3>
<p>This parameter is used to enable/disable incomplete transactions detection in binlog router.
When MaxScale starts an error message may appear if current binlog file is corrupted or an incomplete transaction is found.
During normal operations binlog events are not distributed to the slaves until a <em>COMMIT</em> is seen.
The default value is off, set <em>transaction_safety=on</em> to enable the incomplete transactions detection.</p>
<p>A complete example of a service entry for a binlog router service would be as follows.</p>
<div><pre><span></span>    [Replication]
    type=service
    router=binlogrouter
    servers=masterdb
    version_string=5.6.17-log
    user=maxscale
    passwd=Mhu87p2D
    router_options=uuid=f12fcb7f-b97b-11e3-bc5e-0401152c4c22,server-id=3,user=repl,password=slavepass,master-id=1,filestem=mybin,heartbeat=30,binlogdir=/var/binlogs,transaction_safety=1,master_version=5.6.19-common,master_hostname=common_server,master_uuid=xxx-fff-cccc-common,master-id=999,mariadb10-compatibility=1
</pre></div>


<p>The minimum set of router options that must be given in the configuration are are <em>server-id</em> and <em>master-id</em>, default values may be used for all other options.</p>
<h2 id="listener-section">Listener Section</h2>
<p>As per any service in MaxScale a listener section is required to define the address, port and protocol that is used to listen for incoming connections. Those incoming connections will originate from the slave servers or from a MySQL client in order to administer/configure the master server configuration via SQL commands such as <em>STOP/START SLAVE</em> and <em>CHANGE MASTER TO</em> ...</p>
<pre><code>[Replication Listener]
type=listener
service=Replication
protocol=MySQLClient
port=5308
</code></pre>
<p>The protocol used by slaves for connection to MaxScale is the same <em>MySQLClient</em> protocol that is  used for client applications to connect to databases, therefore the same MaxScale protocol module can be used.</p>
<h1 id="maxscale-replication-diagnostics">MaxScale replication diagnostics</h1>
<p>The binlog router module of MaxScale produces diagnostic output that can be viewed via the <code>maxadmin</code> client application. Running the maxadmin command and issuing a show service command will produce a considerable amount of output that will show both the master connection status and statistics and also a block for each of the slaves currently connected.</p>
<div><pre><span></span>-bash-4.1$ maxadmin show service Replication
    Service 0x1567ef0
        Service:                Replication
        Router:                 binlogrouter (0x7f4ceb96a820)
        State:                  Started
        Master connection DCB:                      0x15693c0
        Master connection state:                    Binlog Dump
        Binlog directory:                           /var/maxscale/binlogs
        Heartbeat period (seconds):                 200
        Number of master connects:                  1
        Number of delayed reconnects:               0
        Current binlog file:                        mybin.000061
        Current binlog position:                    120
        Number of slave servers:                    0
        No. of binlog events received this session: 1002705
        Total no. of binlog events received:        2005410
        No. of bad CRC received from master:        0
        Number of binlog events per minute
        Current        5        10       15       30 Min Avg
              4       4.0      4.0      4.0      4.0
        Number of fake binlog events:           0
        Number of artificial binlog events:     61
        Number of binlog events in error:       0
        Number of binlog rotate events:         60
        Number of heartbeat events:             69
        Number of packets received:             599
        Number of residual data packets:        379
        Average events per packet               3347.9
        Last event from master at:              Thu Jan 29 16:41:53 2015 (10 seconds ago)
        Last event from master:                 0x1b (Heartbeat Event)
        Events received:
            Invalid                                  0
            Start Event V3                           0
            Query Event                              703307
            Stop Event                               55
            Rotate Event                             65
            Integer Session Variable                 0
            Load Event                               0
            Slave Event                              0
            Create File Event                        0
            Append Block Event                       0
            Exec Load Event                          0
            Delete File Event                        0
            New Load Event                           0
            Rand Event                               0
            User Variable Event                      0
            Format Description Event                 61
            Transaction ID Event (2 Phase Commit)    299148
            Begin Load Query Event                   0
            Execute Load Query Event                 0
            Table Map Event                          0
            Write Rows Event (v0)                    0
            Update Rows Event (v0)                   0
            Delete Rows Event (v0)                   0
            Write Rows Event (v1)                    0
            Update Rows Event (v1)                   0
            Delete Rows Event (v1)                   0
            Incident Event                           0
            Heartbeat Event                          69
            Ignorable Event                          0
            Rows Query Event                         0
            Write Rows Event (v2)                    0
            Update Rows Event (v2)                   0
            Delete Rows Event (v2)                   0
            GTID Event                               0
            Anonymous GTID Event                     0
            Previous GTIDS Event                     0
        Started:                Thu Jan 29 16:06:11 2015
        Root user access:           Disabled
        Backend databases
            178.62.50.70:3306  Protocol: MySQLBackend
        Users data:                     0x156c030
        Total connections:              2
        Currently connected:            2
-bash-4.1$
</pre></div>


<h1 id="binlog-router-compatibility">Binlog router compatibility</h1>
<p>Binlog Router Plugin is compatible with MySQL 5.6 and MariaDB 5.5, the current default.</p>
<p>In order to use it with MySQL 5.6, the <em>GTID_MODE</em> setting must be OFF and connecting slaves must not use <em>MASTER_AUTO_POSITION = 1</em> option.</p>
<p>It’s also works with a MariaDB 10.0 setup (master and slaves) but slave connection must not include any GTID feature.</p>
<p>Binlog Router currently does not work for MySQL 5.5 due to missing <em>@@global.binlog_checksum</em> variable.</p>
<h1 id="master-server-setupchange">Master server setup/change</h1>
<p>In the MaxScale ini file the server section for master is no longer required, same for <em>servers=master_server</em> in the service section. The master server setup is currently managed via <em>CHANGE MASTER TO</em> command issued in MySQL client connection to MaxScale or by providing a proper <em>master.ini</em> file in the <em>binlogdir</em>.</p>
<p>If MaxScale starts without <em>master.ini</em> there is no replication configured to any master and slaves cannot register to the router: the binlog router could be later configured via <em>CHANGE MASTER TO</em> and the <em>master.ini</em> file will be written.</p>
<p><em>master.ini</em> file example:</p>
<pre><code>[binlog_configuration]
master_host=127.0.0.1
master_port=3308
master_user=repl
master_password=somepass
filestem=repl-bin
</code></pre>
<p>Enabling replication from a master server requires:</p>
<pre><code>    CHANGE MASTER TO MASTER_HOST=‘$master_server’, MASTER_PORT=$master_port, MASTER_USER='repl', MASTER_PASSWORD=‘somepasswd’, MASTER_LOG_FILE=‘repl-bin.000159', MASTER_LOG_POS=4
</code></pre>
<p>It's possible to specify the desired <em>MASTER_LOG_FILE</em> but position must be 4</p>
<p>The initfile option is no longer available, filestem option also not available as the stem is automatically set by parsing <em>MASTER_LOG_FILE</em>.</p>
<h3 id="stopstart-the-replication">Stop/start the replication</h3>
<p>When router is configured and it is properly working it is possible to stop/start replication:</p>
<pre><code>MariaDB&gt; STOP SLAVE;
...
MariaDB&gt; SHOW SLAVE STATUS;
...
MariaDB&gt; START SLAVE;
</code></pre>
<p>Connected or new slave connections are not affected: this <em>STOP/START</em> only controls the the connection to the master and the binlog events receiving.</p>
<h3 id="change-the-master-server-configuration">Change the Master server configuration</h3>
<p>When router is configured and it is properly working it is possible to change the master parameters.
First step is stop the replication from the master.</p>
<pre><code>MariaDB&gt; STOP SLAVE;
</code></pre>
<p>Next step is the master configuration</p>
<pre><code>MariaDB&gt; CHANGE MASTER TO ...
</code></pre>
<p>A successful configuration change results in <em>master.ini</em> being updated.</p>
<p>Any error is reported in the MySQL and in log files</p>
<p>The supported options are:</p>
<pre><code>MASTER_HOST
MASTER_PORT
MASTER_USER
MASTER_PASSWORD
MASTER_LOG_FILE
MASTER_LOG_POS
</code></pre>
<p>There are some constraints related to <em>MASTER_LOG_FILE</em> and <em>MASTER_LOG_POS</em>:</p>
<p><em>MASTER_LOG_FILE</em> could be changed to next binlog in sequence with <em>MASTER_LOG_POS=4</em> or to current one at current position.</p>
<p>Examples:</p>
<p>1) Current binlog file is ‘mysql-bin.000003', position 88888</p>
<pre><code>MariaDB&gt; CHANGE MASTER TO MASTER_LOG_FILE=‘mysql-bin.000003',MASTER_LOG_POS=8888
</code></pre>
<p>This could be applied to current master_host/port or a new one.
If there is a master server maintenance and a slave is being promoted as master it should be checked that binlog file and position are valid: in case of any error replication stops and errors are reported via <em>SHOW SLAVE STATUS</em> and in error logs.</p>
<p>2) Current binlog file is ‘mysql-bin.000099', position 1234</p>
<pre><code>MariaDB&gt; CHANGE MASTER TO MASTER_LOG_FILE=‘mysql-bin.000100',MASTER_LOG_POS=4
</code></pre>
<p>This could be applied with current master_host/port or a new one
If transaction safety option is on and the current binlog file contains an incomplete transaction it will be truncated to the position where transaction started.
In such situation a proper message is reported in MySQL connection and with next START SLAVE binlog file truncation will occur and MaxScale will request events from the master using the next binlog file at position 4.</p>
<p>The above scenario might refer to a master crash/failure:
 the new server that has just been promoted as master doesn't have last transaction events but it should have the new binlog file (the next in sequence).
Truncating the previous MaxScale binlog is safe as that incomplete transaction is lost.
It should be checked that current master or new one has the new binlog file, in case of any error replication stops and errors are reported via <em>SHOW SLAVE STATUS</em> and in error logs.</p>
<pre><code>MariaDB&gt; START SLAVE;
</code></pre>
<p>Check for any error in log files and with</p>
<pre><code>MariaDB&gt; SHOW SLAVE STATUS;
</code></pre>
<p>In some situations replication state could be <em>STOPPED</em> and proper messages are displayed in error logs and in <em>SHOW SLAVE STATUS</em>,</p>
<p>In order to resolve any mistake done with <em>CHANGE MASTER TO MASTER_LOG_FILE / MASTER_LOG_POS</em>, another administrative command would be helpful.</p>
<pre><code>MariaDB&gt; RESET SLAVE;
</code></pre>
<p>This command removes <em>master.ini</em> file, blanks all master configuration in memory and sets binlog router in unconfigured state: a <em>CHANGE MASTER TO</em> command should be issued for the new configuration.</p>
<p>Note: existing binlog files are not touched by this command.</p>
<h3 id="slave-servers-setup">Slave servers setup</h3>
<p>Examples of <em>CHANGE MASTER TO</em> command issued on a slave server that wants to gets replication events from MaxScale binlog router:</p>
<div><pre><span></span>CHANGE MASTER TO MASTER_HOST=‘$maxscale_IP’, MASTER_PORT=5308, MASTER_USER='repl', MASTER_PASSWORD=‘somepasswd’,
MASTER_LOG_FILE=‘mysql-bin.000001'

CHANGE MASTER TO MASTER_HOST=‘$maxscale_IP’, MASTER_PORT=5308, MASTER_USER='repl', MASTER_PASSWORD=‘somepasswd’,
MASTER_LOG_FILE=‘mysql-bin.000159', MASTER_LOG_POS=245
</pre></div>


<p>The latter example specifies a <em>MASTER_LOG_POS</em> for the selected <em>MASTER_LOG_FILE</em></p>
<p>Note:</p>
<ul>
<li>
<p><em>MASTER_LOG_FILE</em> must be set to one of existing binlog files in MaxScale binlogdir</p>
</li>
<li>
<p>If <em>MASTER_LOG_POS</em> is not set with <em>CHANGE MASTER TO</em> it defaults to 4</p>
</li>
<li>
<p>Latest binlog file name and pos in MaxScale could be find via maxadmin output or from mysql client connected to MaxScale:</p>
</li>
</ul>
<p>Example:</p>
<div><pre><span></span>-bash-4.1$ mysql -h 127.0.0.1 -P 5308 -u$user -p$pass

    MySQL [(none)]&gt; show master status\G
    *************************** 1. row ***************************
             File: mysql-bin.000181
             Position: 2569
</pre></div>


<h1 id="enabling-mariadb-10-compatibility">Enabling MariaDB 10 compatibility</h1>
<p>MariaDB 10 has different slave registration phase so an option is required:</p>
<div><pre><span></span>router_options=...., mariadb10-compatibility=1
</pre></div>


<p>version_string should be modified in order to present MariaDB 10 version when MaxScale sends server handshake packet.</p>
<div><pre><span></span>version_string=10.0.17-log
</pre></div>


<h1 id="new-mariadb-events-in-diagnostics">New MariaDB events in Diagnostics</h1>
<p>With a MariaDB 10 setups new events are displayed when master server is MariaDB 10.</p>
<div><pre><span></span>MariaDB 10 Annotate Rows Event 0
MariaDB 10 Binlog Checkpoint Event 0
MariaDB 10 GTID Event 0
MariaDB 10 GTID List Event 0
</pre></div>
    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/maxscale-as-a-replication-proxy/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/maxscale-as-a-replication-proxy/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/maxscale-simple-sharding-with-two-servers/">
                        ← MaxScale Simple Sharding with Two Servers
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/maxscale-14-tutorials/">
                        ↑ MaxScale 1.4 Tutorials ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/tutorials-maxscale-filters/">
                        MaxScale Filters →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="4958" data-comments-url="/kb/en/maxscale-as-a-replication-proxy/+comments"
         data-reply-url="/kb/en/maxscale-as-a-replication-proxy/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/maxscale-14-tutorials/">
                    ↑ MaxScale 1.4 Tutorials ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/setting-up-maxscale/">
                            
                             Setting up MaxScale
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/maxscale-administration-tutorial/">
                            
                             MaxScale Administration Tutorial
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/maxscale-connection-routing-with-mysql-replication/">
                            
                            MaxScale Connection Routing with MySQL Replication
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/maxscale-readwrite-splitting-with-mysql-replication/">
                            
                            MaxScale Read/Write Splitting with MySQL Replication
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/maxscale-connection-routing-with-galera-cluster/">
                            
                            MaxScale Connection Routing with Galera Cluster
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/maxscale-readwrite-splitting-with-galera-cluster/">
                            
                            MaxScale Read/Write Splitting with Galera Cluster
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/maxscale-simple-sharding-with-two-servers/">
                            
                            MaxScale Simple Sharding with Two Servers
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span> MaxScale as a replication proxy</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/tutorials-maxscale-filters/">
                            
                            MaxScale Filters
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/maxinfo-plugin/">
                            
                             MaxInfo Plugin
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mysql-cluster-setup-and-maxscale-configuration/">
                            
                             MySQL Cluster setup and MaxScale configuration
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/maxscale-nagios-plugins-for-nagios-351/">
                            
                             MaxScale Nagios plugins, for Nagios 3.5.1
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/rabbit-mq-setup-and-maxscale-integration/">
                            
                             Rabbit MQ setup and MaxScale Integration
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/data-archiving-with-mqfilter-and-tee-filters/">
                            
                             Data archiving with Mqfilter and Tee filters
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/avrorouter-tutorial/">
                            
                             Avrorouter Tutorial
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row row-10">
                <div class="col-md-2 col-xs-4 item">
                    <h5>
                        <a href="/products" title="Products">Products</a>
                    </h5>
                    <ul>
                        <li id="menu-item-7816" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7816"><a href="https://mariadb.com/products/mariadb-platform/">MariaDB Platform</a></li>
                        <li id="menu-item-7815" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7815"><a href="https://mariadb.com/products/skysql/">MariaDB SkySQL</a></li>
                        <li id="menu-item-4172" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4172"><a href="https://mariadb.com/pricing/">Pricing</a></li>
                        <li id="menu-item-4163" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4163"><a href="https://mariadb.com/downloads/">Download MariaDB</a></li>
                    </ul>
                </div>
                <div class="col-md-2 col-xs-4 item">
                    <h5>
                        <a href="/services" title="Services">Services</a>
                    </h5>
                    <ul>
                        <li id="menu-item-4169" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4169"><a href="https://mariadb.com/services/remote-dba/">Remote DBA</a></li>
                        <li id="menu-item-41691" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4169"><a href="https://mariadb.com/services/skydba/">SkyDBA</a></li>
                        <li id="menu-item-4167" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4167"><a href="https://mariadb.com/services/enterprise-architect/">Enterprise Architect</a></li>
                        <li id="menu-item-4170" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4170"><a href="https://mariadb.com/services/technical-support-services/">Technical Support</a></li>
                        <li id="menu-item-4168" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4168"><a href="https://mariadb.com/services/migration-practice/">Migration Practice</a></li>
                        <li id="menu-item-4166" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4166"><a href="https://mariadb.com/services/consulting/">Consulting</a></li>
                        <li id="menu-item-4171" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4171"><a href="https://mariadb.com/services/training/">Training</a></li>
                    </ul>
                </div>
                <div class="col-md-2 col-xs-4 item">
                    <h5>
                        <a href="/resources" title="Resources">Resources</a>
                    </h5>
                    <ul>
                        <li id="menu-item-41751" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4175"><a href="https://mariadb.com/docs/">Documentation</a></li>
                        <li id="menu-item-41752" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4175"><a href="https://mariadb.com/developers/">Developers</a></li>
                        <li id="menu-item-4175" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4175"><a href="https://mariadb.com/resources/blog/">Blog</a></li>
                        <li id="menu-item-5462" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5462"><a href="https://support.mariadb.com">Support</a></li>
                        <li id="menu-item-6004" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6004"><a href="https://mariadb.com/openworks/">OpenWorks</a></li>
                        <li id="menu-item-60041" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6004"><a href="https://mariadb.com/resources/customer-stories/">Customer Stories</a></li>
                        <li id="menu-item-7817" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7817"><a href="https://mariadb.com/resources/events/">Events</a></li>
                        <li id="menu-item-4177" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4177"><a href="https://mariadb.com/roadshow/">MariaDB Roadshow</a></li>
                    </ul>
                </div>
                <div class="visible-xs visible-sm clear"></div>
                <div class="col-md-2 col-xs-5 item">
                    <h5>
                        <a href="/about-us" title="About MariaDB">About</a>
                    </h5>
                    <ul>
                        <li id="menu-item-4173" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4173"><a href="https://mariadb.com/contact/">Contact</a></li>
                        <li id="menu-item-4161" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4161"><a href="https://mariadb.com/about-us/leadership/">Leadership</a></li>
                        <li id="menu-item-4162" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4162"><a href="https://mariadb.com/about-us/partners/">Partners</a></li>
                        <li id="menu-item-4174" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4174"><a href="https://mariadb.com/newsroom/">Newsroom</a></li>
                        <li id="menu-item-4160" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4160"><a href="https://mariadb.com/about-us/investors/">Investors</a></li>
                        <li id="menu-item-4159" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4159"><a href="https://mariadb.com/about-us/careers/">Careers</a></li>
                        <li id="menu-item-41591" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4159"><a href="https://mariadb.com/trust/">Trust Center</a></li>
                        <li id="menu-item-41592" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4159"><a href="https://mariadb.com/vulnerability-reporting/">Vulnerability Reporting</a></li>
                    </ul>
                </div>
                <div class="col-md-4 col-xs-7 item">
                    <div id="block-footercontact" class="block block-block-content block-block-content22b3af28-0754-44ec-a5c6-4466568f37e3">
                        <h5><a href="/contact" title="Contact">Contact</a></h5>
                    </div>
                    <div class="social">
                        <ul class="list-inline">
                            <li>
                                <a target="_blank" href="https://www.facebook.com/MariaDB.dbms/" title="Facebook">
                                    <i class="fa fa-facebook" aria-hidden="true"></i>
                                </a>
                            </li>
                            <li>
                                <a target="_blank" href="https://twitter.com/mariadb" title="Twitter">
                                    <i class="fa fa-twitter" aria-hidden="true"></i>
                                </a>
                            </li>
                            <li>
                                <a target="_blank" href="https://www.linkedin.com/company/mariadb-corporation?trk=company_logo " title="LinkedIn">
                                    <i class="fa fa-linkedin" aria-hidden="true"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <p>Subscribe to our newsletter!</p>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-copyright">
        <div class="container text-center">
            <ul class="list-inline no-margin">
                <li>
                    <a href="/legal" title="Legal">Legal</a>
                </li>
                <li>
                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                </li>
                <li>
                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                </li>
            </ul>
            <p>Copyright &copy; 2023 MariaDB. All rights reserved.</p>
        </div>
    </div>
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.fed4ec768178.js" charset="utf-8"></script>

</html>